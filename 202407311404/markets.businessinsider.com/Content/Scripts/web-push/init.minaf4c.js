!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.firebase=t()}(this,function(){!function(e){if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],r=function(e){return e&&DataView.prototype.isPrototypeOf(e)},i=ArrayBuffer.isView||function(e){return e&&n.indexOf(Object.prototype.toString.call(e))>-1};h.prototype.append=function(e,t){e=a(e),t=c(t);var n=this.map[e];this.map[e]=n?n+","+t:t},h.prototype.delete=function(e){delete this.map[a(e)]},h.prototype.get=function(e){return e=a(e),this.has(e)?this.map[e]:null},h.prototype.has=function(e){return this.map.hasOwnProperty(a(e))},h.prototype.set=function(e,t){this.map[a(e)]=c(t)},h.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},h.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),u(e)},h.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),u(e)},h.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),u(e)},t.iterable&&(h.prototype[Symbol.iterator]=h.prototype.entries);var o=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},_.call(b.prototype),_.call(y.prototype),y.prototype.clone=function(){return new y(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},y.error=function(){var e=new y(null,{status:0,statusText:""});return e.type="error",e};var s=[301,302,303,307,308];y.redirect=function(e,t){if(-1===s.indexOf(t))throw new RangeError("Invalid status code");return new y(null,{status:t,headers:{location:e}})},e.Headers=h,e.Request=b,e.Response=y,e.fetch=function(e,n){return new Promise(function(r,i){var o=new b(e,n),s=new XMLHttpRequest;s.onload=function(){var e,t,n={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new h,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var n=e.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();t.append(r,i)}}),t)};n.url="responseURL"in s?s.responseURL:n.headers.get("X-Request-URL");var i="response"in s?s.response:s.responseText;r(new y(i,n))},s.onerror=function(){i(new TypeError("Network request failed"))},s.ontimeout=function(){i(new TypeError("Network request failed"))},s.open(o.method,o.url,!0),"include"===o.credentials?s.withCredentials=!0:"omit"===o.credentials&&(s.withCredentials=!1),"responseType"in s&&t.blob&&(s.responseType="blob"),o.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send(void 0===o._bodyInit?null:o._bodyInit)})},e.fetch.polyfill=!0}function a(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function u(e){var n={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(n[Symbol.iterator]=function(){return n}),n}function h(e){this.map={},e instanceof h?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function f(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function p(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function l(e){var t=new FileReader,n=p(t);return t.readAsArrayBuffer(e),n}function d(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function _(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&r(e))this._bodyArrayBuffer=d(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!i(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=d(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var e=f(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?f(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(l)}),this.text=function(){var e,t,n,r=f(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,n=p(t=new FileReader),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(v)}),this.json=function(){return this.text().then(JSON.parse)},this}function b(e,t){var n,r,i=(t=t||{}).body;if(e instanceof b){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new h(e.headers)),this.method=e.method,this.mode=e.mode,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new h(t.headers)),this.method=(r=(n=t.method||this.method||"GET").toUpperCase(),o.indexOf(r)>-1?r:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function v(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}}),t}function y(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new h(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!=typeof self?self:void 0);var e=setTimeout;function t(){}function n(e){if(!(this instanceof n))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],a(e,this)}function r(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,n._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null!==n){var r;try{r=n(e._value)}catch(e){return void o(t.promise,e)}i(t.promise,r)}else(1===e._state?i:o)(t.promise,e._value)})):e._deferreds.push(t)}function i(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var r=t.then;if(t instanceof n)return e._state=3,e._value=t,void s(e);if("function"==typeof r)return void a((i=r,c=t,function(){i.apply(c,arguments)}),e)}e._state=1,e._value=t,s(e)}catch(t){o(e,t)}var i,c}function o(e,t){e._state=2,e._value=t,s(e)}function s(e){2===e._state&&0===e._deferreds.length&&n._immediateFn(function(){e._handled||n._unhandledRejectionFn(e._value)});for(var t=0,i=e._deferreds.length;t<i;t++)r(e,e._deferreds[t]);e._deferreds=null}function a(e,t){var n=!1;try{e(function(e){n||(n=!0,i(t,e))},function(e){n||(n=!0,o(t,e))})}catch(e){if(n)return;n=!0,o(t,e)}}n.prototype.catch=function(e){return this.then(null,e)},n.prototype.then=function(e,n){var i=new this.constructor(t);return r(this,new function(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}(e,n,i)),i},n.prototype.finally=function(e){var t=this.constructor;return this.then(function(n){return t.resolve(e()).then(function(){return n})},function(n){return t.resolve(e()).then(function(){return t.reject(n)})})},n.all=function(e){return new n(function(t,n){if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(e);if(0===r.length)return t([]);var i=r.length;function o(e,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,function(t){o(e,t)},n)}r[e]=s,0==--i&&t(r)}catch(e){n(e)}}for(var s=0;s<r.length;s++)o(s,r[s])})},n.resolve=function(e){return e&&"object"==typeof e&&e.constructor===n?e:new n(function(t){t(e)})},n.reject=function(e){return new n(function(t,n){n(e)})},n.race=function(e){return new n(function(t,n){for(var r=0,i=e.length;r<i;r++)e[r].then(t,n)})},n._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(t){e(t,0)},n._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var c=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object");}();function u(e,t){return e(t={exports:{}},t.exports),t.exports}c.Promise||(c.Promise=n);var h=u(function(e){var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)}),f=u(function(e){var t=e.exports={version:"2.5.5"};"number"==typeof __e&&(__e=t)}),p=(f.version,function(e){return"object"==typeof e?null!==e:"function"==typeof e}),l=function(e){if(!p(e))throw TypeError(e+" is not an object!");return e},d=function(e){try{return!!e()}catch(e){return!0}},_=!d(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),b=h.document,v=p(b)&&p(b.createElement),y=!_&&!d(function(){return 7!=Object.defineProperty(("div",v?b.createElement("div"):{}),"a",{get:function(){return 7}}).a}),E=Object.defineProperty,m={f:_?Object.defineProperty:function(e,t,n){if(l(e),t=function(e,t){if(!p(e))return e;var n,r;if("function"==typeof(n=e.toString)&&!p(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!p(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value");}(t),l(n),y)try{return E(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},g=_?function(e,t,n){return m.f(e,t,{enumerable:!1,configurable:!0,writable:!0,value:n})}:function(e,t,n){return e[t]=n,e},T={}.hasOwnProperty,w=function(e,t){return T.call(e,t)},S=0,O=Math.random(),I=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++S+O).toString(36))},D=u(function(e){var t=I("src"),n=Function.toString,r=(""+n).split("toString");f.inspectSource=function(e){return n.call(e)},(e.exports=function(e,n,i,o){var s="function"==typeof i;s&&(w(i,"name")||g(i,"name",n)),e[n]!==i&&(s&&(w(i,t)||g(i,t,e[n]?""+e[n]:r.join(String(n)))),e===h?e[n]=i:o?e[n]?e[n]=i:g(e,n,i):(delete e[n],g(e,n,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[t]||n.call(this)})}),A=function(e,t,n){if(function(t){if("function"!=typeof e)throw TypeError(e+" is not a function!");}(),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},N=function(e,t,n){var r,i,o,s,a=e&N.F,c=e&N.G,u=e&N.S,p=e&N.P,l=e&N.B,d=c?h:u?h[t]||(h[t]={}):(h[t]||{}).prototype,_=c?f:f[t]||(f[t]={}),b=_.prototype||(_.prototype={});for(r in c&&(n=t),n)o=((i=!a&&d&&void 0!==d[r])?d:n)[r],s=l&&i?A(o,h):p&&"function"==typeof o?A(Function.call,o):o,d&&D(d,r,o,e&N.U),_[r]!=o&&g(_,r,s),p&&b[r]!=o&&(b[r]=o)};h.core=f,N.F=1,N.G=2,N.S=4,N.P=8,N.B=16,N.W=32,N.U=64,N.R=128;var k=N,P={}.toString,C=function(e){return P.call(e).slice(8,-1)},B=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==C(e)?e.split(""):Object(e)},R=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e},U=Math.ceil,L=Math.floor,F=Math.min,K=function(e){return e>0?F((t=e,isNaN(t=+t)?0:(t>0?L:U)(t)),9007199254740991):0;var t},M=Array.isArray||function(e){return"Array"==C(e)},j=h["__core-js_shared__"]||(h["__core-js_shared__"]={}),x=u(function(e){var t,n=j[t="wks"]||(j[t]={}),r=h.Symbol,i="function"==typeof r;(e.exports=function(e){return n[e]||(n[e]=i&&r[e]||(i?r:I)("Symbol."+e))}).store=n}),W=x("species"),V=function(e,t){return new(M(n=e)&&("function"!=typeof(r=n.constructor)||r!==Array&&!M(r.prototype)||(r=void 0),p(r)&&null===(r=r[W])&&(r=void 0)),void 0===r?Array:r)(t);var n,r},G=function(e,t){var n=1==e,r=2==e,i=3==e,o=4==e,s=6==e,a=5==e||s,c=t||V;return function(t,u,h){for(var f,p,l=Object(R(t)),d=B(l),_=A(u,h,3),b=K(d.length),v=0,y=n?c(t,b):r?c(t,0):void 0;b>v;v++)if((a||v in d)&&(p=_(f=d[v],v,l),e))if(n)y[v]=p;else if(p)switch(e){case 3:return!0;case 5:return f;case 6:return v;case 2:y.push(f)}else if(o)return!1;return s?-1:i||o?o:y}},z=x("unscopables"),H=Array.prototype;null==H[z]&&g(H,z,{});var Y=function(e){H[z][e]=!0},q=G(5),$=!0;"find"in[]&&Array(1).find(function(){$=!1}),k(k.P+k.F*$,"Array",{find:function(e){return q(this,e,arguments.length>1?arguments[1]:void 0)}}),Y("find"),f.Array.find;var X=G(6),J=!0;"findIndex"in[]&&Array(1).findIndex(function(){J=!1}),k(k.P+k.F*J,"Array",{findIndex:function(e){return X(this,e,arguments.length>1?arguments[1]:void 0)}}),Y("findIndex"),f.Array.findIndex;var Q=x("match"),Z=x("match"),ee="".startsWith;k(k.P+k.F*function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[Z]=!1,!"/./"[e](t)}catch(e){}}return!0}("startsWith"),"String",{startsWith:function(e){var t=function(e,t,n){if(p(r=t)&&(void 0!==(i=r[Q])?i:"RegExp"==C(r)))throw TypeError("String#"+n+" doesn't accept regex!");var r,i;return String(R(e))}(this,e,"startsWith"),n=K(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return ee?ee.call(t,r,n):t.slice(n,n+r.length)===r}}),f.String.startsWith;var te=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function ne(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&(e[n]=ne(e[n],t[n]));return e}function re(e,t,n){e[t]=n}var ie="FirebaseError",oe=Error.captureStackTrace,se=function(e,t){if(this.code=e,this.message=t,oe)oe(this,ae.prototype.create);else{var n=Error.apply(this,arguments);this.name=ie,Object.defineProperty(this,"stack",{get:function(){return n.stack}})}};se.prototype=Object.create(Error.prototype),se.prototype.constructor=se,se.prototype.name=ie;var ae=function(){function e(e,t,n){this.service=e,this.serviceName=t,this.errors=n,this.pattern=/\{\$([^}]+)}/g}return e.prototype.create=function(e,t){void 0===t&&(t={});var n,r=this.errors[e],i=this.service+"/"+e;n=void 0===r?"Error":r.replace(this.pattern,function(e,n){var r=t[n];return void 0!==r?r.toString():"<"+n+"?>"}),n=this.serviceName+": "+n+" ("+i+").";var o=new se(i,n);for(var s in t)t.hasOwnProperty(s)&&"_"!==s.slice(-1)&&(o[s]=t[s]);return o},e}();function ce(e,t){var n=new ue(e,t);return n.subscribe.bind(n)}!function(e){function t(){var t=e.call(this)||this;t.chain_=[],t.buf_=[],t.W_=[],t.pad_=[],t.inbuf_=0,t.total_=0,t.blockSize=64,t.pad_[0]=128;for(var n=1;n<t.blockSize;++n)t.pad_[n]=0;return t.reset(),t}(function(e,t){function n(){this.constructor=e}te(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)})(t,e),t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(e,t){t||(t=0);var n=this.W_;if("string"==typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,s,a=this.chain_[0],c=this.chain_[1],u=this.chain_[2],h=this.chain_[3],f=this.chain_[4];for(r=0;r<80;r++)r<40?r<20?(o=h^c&(u^h),s=1518500249):(o=c^u^h,s=1859775393):r<60?(o=c&u|h&(c|u),s=2400959708):(o=c^u^h,s=3395469782),i=(a<<5|a>>>27)+o+f+s+n[r]&4294967295,f=h,h=u,u=4294967295&(c<<30|c>>>2),c=a,a=i;this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+c&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+f&4294967295},t.prototype.update=function(e,t){if(null!=e){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<t;){if(0==o)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[o]=e.charCodeAt(r),++r,++o==this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++r,++o==this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}},t.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e}}(function(){this.blockSize=-1});var ue=function(){function e(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(function(){e(n)}).catch(function(e){n.error(e)})}return e.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})},e.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)}),this.close(e)},e.prototype.complete=function(){this.forEachObserver(function(e){e.complete()}),this.close()},e.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}(e)?e:{next:e,error:t,complete:n}).next&&(r.next=he),void 0===r.error&&(r.error=he),void 0===r.complete&&(r.complete=he);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}}),this.observers.push(r),o},e.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},e.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},e.prototype.sendOne=function(e,t){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})},e.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(function(){t.observers=void 0,t.onNoObservers=void 0}))},e}();function he(){}var fe=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},pe="[DEFAULT]",le=[],de=function(){function e(e,t,n){this.firebase_=n,this.isDeleted_=!1,this.services_={},this.name_=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled||!1,this.options_=ne(void 0,e),this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(e){le.push(e),setTimeout(function(){return e(null)},0)},removeAuthTokenListener:function(e){le=le.filter(function(t){return t!==e})}}}return Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this._automaticDataCollectionEnabled},set:function(e){this.checkDestroyed_(),this._automaticDataCollectionEnabled=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),e.prototype.delete=function(){var e=this;return new Promise(function(t){e.checkDestroyed_(),t()}).then(function(){e.firebase_.INTERNAL.removeApp(e.name_);var t=[];return Object.keys(e.services_).forEach(function(n){Object.keys(e.services_[n]).forEach(function(r){t.push(e.services_[n][r])})}),Promise.all(t.map(function(e){return e.INTERNAL.delete()}))}).then(function(){e.isDeleted_=!0,e.services_={}})},e.prototype._getService=function(e,t){if(void 0===t&&(t=pe),this.checkDestroyed_(),this.services_[e]||(this.services_[e]={}),!this.services_[e][t]){var n=t!==pe?t:void 0,r=this.firebase_.INTERNAL.factories[e](this,this.extendApp.bind(this),n);this.services_[e][t]=r}return this.services_[e][t]},e.prototype.extendApp=function(e){var t=this;ne(this,e),e.INTERNAL&&e.INTERNAL.addAuthTokenListener&&(le.forEach(function(e){t.INTERNAL.addAuthTokenListener(e)}),le=[])},e.prototype.checkDestroyed_=function(){this.isDeleted_&&_e("app-deleted",{name:this.name_})},e}();function _e(e,t){throw be.create(e,t);}de.prototype.name&&de.prototype.options||de.prototype.delete||console.log("dc");var be=new ae("app","Firebase",{"no-app":"No Firebase App '{$name}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$name}","duplicate-app":"Firebase App named '{$name}' already exists","app-deleted":"Firebase App named '{$name}' already deleted","duplicate-service":"Firebase service named '{$name}' already registered","sa-not-supported":"Initializing the Firebase SDK with a service account is only allowed in a Node.js environment. On client devices, you should instead initialize the SDK with an api key and auth domain","invalid-app-argument":"firebase.{$name}() takes either no argument or a Firebase App instance."});return function e(){var t={},n={},r={},i={__esModule:!0,initializeApp:function(e,n){(void 0===n&&(n={}),"object"!=typeof n||null===n)&&(n={name:n});var r=n;void 0===r.name&&(r.name=pe);var o=r.name;"string"==typeof o&&o||_e("bad-app-name",{name:o+""}),fe(t,o)&&_e("duplicate-app",{name:o});var s=new de(e,r,i);return t[o]=s,a(s,"create"),s},app:o,apps:null,Promise:Promise,SDK_VERSION:"5.0.2",INTERNAL:{registerService:function(e,t,a,c,u){n[e]&&_e("duplicate-service",{name:e}),n[e]=t,c&&(r[e]=c,s().forEach(function(e){c("create",e)}));var h=function(t){return void 0===t&&(t=o()),"function"!=typeof t[e]&&_e("invalid-app-argument",{name:e}),t[e]()};return void 0!==a&&ne(h,a),i[e]=h,de.prototype[e]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this._getService.bind(this,e).apply(this,u?t:[])},h},createFirebaseNamespace:e,extendNamespace:function(e){ne(i,e)},createSubscribe:ce,ErrorFactory:ae,removeApp:function(e){a(t[e],"delete"),delete t[e]},factories:n,useAsService:c,Promise:Promise,deepExtend:ne}};function o(e){return fe(t,e=e||pe)||_e("no-app",{name:e}),t[e]}function s(){return Object.keys(t).map(function(e){return t[e]})}function a(e,t){Object.keys(n).forEach(function(n){var i=c(e,n);null!==i&&r[i]&&r[i](t,e)})}function c(e,t){if("serverAuth"===t)return null;var n=t;return e.options,n}return re(i,"default",i),Object.defineProperty(i,"apps",{get:s}),re(o,"App",de),i}()}),function(e,t){try{t=t&&t.hasOwnProperty("default")?t.default:t;var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function r(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};function o(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})}function s(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=r[2&o[0]?"return":o[0]?"throw":"next"])&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[0,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var a="FirebaseError",c=Error.captureStackTrace,u=function(e,t){if(this.code=e,this.message=t,c)c(this,h.prototype.create);else{var n=Error.apply(this,arguments);this.name=a,Object.defineProperty(this,"stack",{get:function(){return n.stack}})}};u.prototype=Object.create(Error.prototype),u.prototype.constructor=u,u.prototype.name=a;var h=function(){function e(e,t,n){this.service=e,this.serviceName=t,this.errors=n,this.pattern=/\{\$([^}]+)}/g}return e.prototype.create=function(e,t){void 0===t&&(t={});var n,r=this.errors[e],i=this.service+"/"+e;n=void 0===r?"Error":r.replace(this.pattern,function(e,n){var r=t[n];return void 0!==r?r.toString():"<"+n+"?>"}),n=this.serviceName+": "+n+" ("+i+").";var o=new u(i,n);for(var s in t)t.hasOwnProperty(s)&&"_"!==s.slice(-1)&&(o[s]=t[s]);return o},e}();function f(e,t){var n=new p(e,t);return n.subscribe.bind(n)}!function(e){function t(){var t=e.call(this)||this;t.chain_=[],t.buf_=[],t.W_=[],t.pad_=[],t.inbuf_=0,t.total_=0,t.blockSize=64,t.pad_[0]=128;for(var n=1;n<t.blockSize;++n)t.pad_[n]=0;return t.reset(),t}r(t,e),t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(e,t){t||(t=0);var n=this.W_;if("string"==typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,s,a=this.chain_[0],c=this.chain_[1],u=this.chain_[2],h=this.chain_[3],f=this.chain_[4];for(r=0;r<80;r++)r<40?r<20?(o=h^c&(u^h),s=1518500249):(o=c^u^h,s=1859775393):r<60?(o=c&u|h&(c|u),s=2400959708):(o=c^u^h,s=3395469782),i=(a<<5|a>>>27)+o+f+s+n[r]&4294967295,f=h,h=u,u=4294967295&(c<<30|c>>>2),c=a,a=i;this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+c&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+f&4294967295},t.prototype.update=function(e,t){if(null!=e){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<t;){if(0==o)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[o]=e.charCodeAt(r),++r,++o==this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++r,++o==this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}},t.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e}}(function(){this.blockSize=-1});var p=function(){function e(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(function(){e(n)}).catch(function(e){n.error(e)})}return e.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})},e.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)}),this.close(e)},e.prototype.complete=function(){this.forEachObserver(function(e){e.complete()}),this.close()},e.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}(e)?e:{next:e,error:t,complete:n}).next&&(r.next=l),void 0===r.error&&(r.error=l),void 0===r.complete&&(r.complete=l);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}}),this.observers.push(r),o},e.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},e.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},e.prototype.sendOne=function(e,t){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})},e.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(function(){t.observers=void 0,t.onNoObservers=void 0}))},e}();function l(){}var d,_,b,v={AVAILABLE_IN_WINDOW:"only-available-in-window",AVAILABLE_IN_SW:"only-available-in-sw",SHOULD_BE_INHERITED:"should-be-overriden",BAD_SENDER_ID:"bad-sender-id",INCORRECT_GCM_SENDER_ID:"incorrect-gcm-sender-id",PERMISSION_DEFAULT:"permission-default",PERMISSION_BLOCKED:"permission-blocked",UNSUPPORTED_BROWSER:"unsupported-browser",NOTIFICATIONS_BLOCKED:"notifications-blocked",FAILED_DEFAULT_REGISTRATION:"failed-serviceworker-registration",SW_REGISTRATION_EXPECTED:"sw-registration-expected",GET_SUBSCRIPTION_FAILED:"get-subscription-failed",INVALID_SAVED_TOKEN:"invalid-saved-token",SW_REG_REDUNDANT:"sw-reg-redundant",TOKEN_SUBSCRIBE_FAILED:"token-subscribe-failed",TOKEN_SUBSCRIBE_NO_TOKEN:"token-subscribe-no-token",TOKEN_SUBSCRIBE_NO_PUSH_SET:"token-subscribe-no-push-set",TOKEN_UNSUBSCRIBE_FAILED:"token-unsubscribe-failed",TOKEN_UPDATE_FAILED:"token-update-failed",TOKEN_UPDATE_NO_TOKEN:"token-update-no-token",USE_SW_BEFORE_GET_TOKEN:"use-sw-before-get-token",INVALID_DELETE_TOKEN:"invalid-delete-token",DELETE_TOKEN_NOT_FOUND:"delete-token-not-found",DELETE_SCOPE_NOT_FOUND:"delete-scope-not-found",BG_HANDLER_FUNCTION_EXPECTED:"bg-handler-function-expected",NO_WINDOW_CLIENT_TO_MSG:"no-window-client-to-msg",UNABLE_TO_RESUBSCRIBE:"unable-to-resubscribe",NO_FCM_TOKEN_FOR_RESUBSCRIBE:"no-fcm-token-for-resubscribe",FAILED_TO_DELETE_TOKEN:"failed-to-delete-token",NO_SW_IN_REG:"no-sw-in-reg",BAD_SCOPE:"bad-scope",BAD_VAPID_KEY:"bad-vapid-key",BAD_SUBSCRIPTION:"bad-subscription",BAD_TOKEN:"bad-token",BAD_PUSH_SET:"bad-push-set",FAILED_DELETE_VAPID_KEY:"failed-delete-vapid-key",INVALID_PUBLIC_VAPID_KEY:"invalid-public-vapid-key",USE_PUBLIC_KEY_BEFORE_GET_TOKEN:"use-public-key-before-get-token",PUBLIC_KEY_DECRYPTION_FAILED:"public-vapid-key-decryption-failed"},y=((d={})[v.AVAILABLE_IN_WINDOW]="This method is available in a Window context.",d[v.AVAILABLE_IN_SW]="This method is available in a service worker context.",d[v.SHOULD_BE_INHERITED]="This method should be overriden by extended classes.",d[v.BAD_SENDER_ID]="Please ensure that 'messagingSenderId' is set correctly in the options passed into firebase.initializeApp().",d[v.PERMISSION_DEFAULT]="The required permissions were not granted and dismissed instead.",d[v.PERMISSION_BLOCKED]="The required permissions were not granted and blocked instead.",d[v.UNSUPPORTED_BROWSER]="This browser doesn't support the API's required to use the firebase SDK.",d[v.NOTIFICATIONS_BLOCKED]="Notifications have been blocked.",d[v.FAILED_DEFAULT_REGISTRATION]="We are unable to register the default service worker. {$browserErrorMessage}",d[v.SW_REGISTRATION_EXPECTED]="A service worker registration was the expected input.",d[v.GET_SUBSCRIPTION_FAILED]="There was an error when trying to get any existing Push Subscriptions.",d[v.INVALID_SAVED_TOKEN]="Unable to access details of the saved token.",d[v.SW_REG_REDUNDANT]="The service worker being used for push was made redundant.",d[v.TOKEN_SUBSCRIBE_FAILED]="A problem occured while subscribing the user to FCM: {$message}",d[v.TOKEN_SUBSCRIBE_NO_TOKEN]="FCM returned no token when subscribing the user to push.",d[v.TOKEN_SUBSCRIBE_NO_PUSH_SET]="FCM returned an invalid response when getting an FCM token.",d[v.TOKEN_UNSUBSCRIBE_FAILED]="A problem occured while unsubscribing the user from FCM: {$message}",d[v.TOKEN_UPDATE_FAILED]="A problem occured while updating the user from FCM: {$message}",d[v.TOKEN_UPDATE_NO_TOKEN]="FCM returned no token when updating the user to push.",d[v.USE_SW_BEFORE_GET_TOKEN]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",d[v.INVALID_DELETE_TOKEN]="You must pass a valid token into deleteToken(), i.e. the token from getToken().",d[v.DELETE_TOKEN_NOT_FOUND]="The deletion attempt for token could not be performed as the token was not found.",d[v.DELETE_SCOPE_NOT_FOUND]="The deletion attempt for service worker scope could not be performed as the scope was not found.",d[v.BG_HANDLER_FUNCTION_EXPECTED]="The input to setBackgroundMessageHandler() must be a function.",d[v.NO_WINDOW_CLIENT_TO_MSG]="An attempt was made to message a non-existant window client.",d[v.UNABLE_TO_RESUBSCRIBE]="There was an error while re-subscribing the FCM token for push messaging. Will have to resubscribe the user on next visit. {$message}",d[v.NO_FCM_TOKEN_FOR_RESUBSCRIBE]="Could not find an FCM token and as a result, unable to resubscribe. Will have to resubscribe the user on next visit.",d[v.FAILED_TO_DELETE_TOKEN]="Unable to delete the currently saved token.",d[v.NO_SW_IN_REG]="Even though the service worker registration was successful, there was a problem accessing the service worker itself.",d[v.INCORRECT_GCM_SENDER_ID]="Please change your web app manifest's 'gcm_sender_id' value to '103953800507' to use Firebase messaging.",d[v.BAD_SCOPE]="The service worker scope must be a string with at least one character.",d[v.BAD_VAPID_KEY]="The public VAPID key is not a Uint8Array with 65 bytes.",d[v.BAD_SUBSCRIPTION]="The subscription must be a valid PushSubscription.",d[v.BAD_TOKEN]="The FCM Token used for storage / lookup was not a valid token string.",d[v.BAD_PUSH_SET]="The FCM push set used for storage / lookup was not not a valid push set string.",d[v.FAILED_DELETE_VAPID_KEY]="The VAPID key could not be deleted.",d[v.INVALID_PUBLIC_VAPID_KEY]="The public VAPID key must be a string.",d[v.PUBLIC_KEY_DECRYPTION_FAILED]="The public VAPID key did not equal 65 bytes when decrypted.",d),E=new h("messaging","Messaging",y),m=new Uint8Array([4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110]),g="https://fcm.googleapis.com";function T(e,t){if(null==e||null==t)return!1;if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(var n=new DataView(e),r=new DataView(t),i=0;i<e.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function w(e){return(t=new Uint8Array(e),btoa(String.fromCharCode.apply(null,t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");var t}(j=_||(_={})).TYPE_OF_MSG="firebase-messaging-msg-type",j.DATA="firebase-messaging-msg-data",(M=b||(b={})).PUSH_MSG_RECEIVED="push-msg-received",M.NOTIFICATION_CLICKED="notification-clicked";var S=function(){function e(){}return e.prototype.getToken=function(e,t,n){return o(this,void 0,void 0,function(){var r,i,o,a,c,u,h,f;return s(this,function(s){switch(s.label){case 0:r=w(t.getKey("p256dh")),i=w(t.getKey("auth")),o="authorized_entity="+e+"&endpoint="+t.endpoint+"&encryption_key="+r+"&encryption_auth="+i,n!==m&&(a=w(n),o+="&application_pub_key="+a),(c=new Headers).append("Content-Type","application/x-www-form-urlencoded"),u={method:"POST",headers:c,body:o},s.label=1;case 1:return s.trys.push([1,4,,5]),[4,fetch(g+"/fcm/connect/subscribe",u)];case 2:return[4,s.sent().json()];case 3:return h=s.sent(),[3,5];case 4:throw s.sent(),E.create(v.TOKEN_SUBSCRIBE_FAILED);case 5:if(h.error)throw f=h.error.message,E.create(v.TOKEN_SUBSCRIBE_FAILED,{message:f});if(!h.token)throw E.create(v.TOKEN_SUBSCRIBE_NO_TOKEN);if(!h.pushSet)throw E.create(v.TOKEN_SUBSCRIBE_NO_PUSH_SET);return[2,{token:h.token,pushSet:h.pushSet}]}})})},e.prototype.updateToken=function(e,t,n,r,i){return o(this,void 0,void 0,function(){var o,a,c,u,h,f,p,l;return s(this,function(s){switch(s.label){case 0:o=w(r.getKey("p256dh")),a=w(r.getKey("auth")),c="push_set="+n+"&token="+t+"&authorized_entity="+e+"&endpoint="+r.endpoint+"&encryption_key="+o+"&encryption_auth="+a,i!==m&&(u=w(i),c+="&application_pub_key="+u),(h=new Headers).append("Content-Type","application/x-www-form-urlencoded"),f={method:"POST",headers:h,body:c},s.label=1;case 1:return s.trys.push([1,4,,5]),[4,fetch(g+"/fcm/connect/subscribe",f)];case 2:return[4,s.sent().json()];case 3:return p=s.sent(),[3,5];case 4:throw s.sent(),E.create(v.TOKEN_UPDATE_FAILED);case 5:if(p.error)throw l=p.error.message,E.create(v.TOKEN_UPDATE_FAILED,{message:l});if(!p.token)throw E.create(v.TOKEN_UPDATE_NO_TOKEN);return[2,p.token]}})})},e.prototype.deleteToken=function(e,t,n){return o(this,void 0,void 0,function(){var r,i,o,a,c;return s(this,function(s){switch(s.label){case 0:r="authorized_entity="+e+"&token="+t+"&pushSet="+n,(i=new Headers).append("Content-Type","application/x-www-form-urlencoded"),o={method:"POST",headers:i,body:r},s.label=1;case 1:return s.trys.push([1,4,,5]),[4,fetch(g+"/fcm/connect/unsubscribe",o)];case 2:return[4,s.sent().json()];case 3:if((a=s.sent()).error)throw c=a.error.message,E.create(v.TOKEN_UNSUBSCRIBE_FAILED,{message:c});return[3,5];case 4:throw s.sent(),E.create(v.TOKEN_UNSUBSCRIBE_FAILED);case 5:return[2]}})})},e}();function O(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}var I="undefined",D="fcm_token_object_Store";var A=function(){function e(){this.dbPromise=null}return e.prototype.get=function(e){return this.createTransaction(function(t){return t.get(e)})},e.prototype.getIndex=function(e,t){return this.createTransaction(function(n){return n.index(e).get(t)})},e.prototype.put=function(e){return this.createTransaction(function(t){return t.put(e)},"readwrite")},e.prototype.delete=function(e){return this.createTransaction(function(t){return t.delete(e)},"readwrite")},e.prototype.closeDatabase=function(){return o(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return this.dbPromise?[4,this.dbPromise]:[3,2];case 1:e.sent().close(),this.dbPromise=null,e.label=2;case 2:return[2]}})})},e.prototype.createTransaction=function(e,t){return void 0===t&&(t="readonly"),o(this,void 0,void 0,function(){var n,r,i,o;return s(this,function(s){switch(s.label){case 0:return[4,this.getDb()];case 1:return n=s.sent(),r=n.transaction(this.objectStoreName,t),i=r.objectStore(this.objectStoreName),[4,(a=e(i),new Promise(function(e,t){a.onsuccess=function(){e(a.result)},a.onerror=function(){t(a.error)}}))];case 2:return o=s.sent(),[2,new Promise(function(e,t){r.oncomplete=function(){e(o)},r.onerror=function(){t(r.error)}})]}var a})})},e.prototype.getDb=function(){var e=this;return this.dbPromise||(this.dbPromise=new Promise(function(t,n){var r=indexedDB.open(e.dbName,e.dbVersion);r.onsuccess=function(){t(r.result)},r.onerror=function(){e.dbPromise=null,n(r.error)},r.onupgradeneeded=function(t){return e.onDbUpgrade(r,t)}})),this.dbPromise},e}(),N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dbName="fcm_token_details_db",t.dbVersion=3,t.objectStoreName="fcm_token_object_Store",t}return r(t,e),t.prototype.onDbUpgrade=function(e,t){var n,r=e.result;switch(t.oldVersion){case 0:(o=r.createObjectStore(this.objectStoreName,{keyPath:"swScope"})).createIndex("fcmSenderId","fcmSenderId",{unique:!1}),o.createIndex("fcmToken","fcmToken",{unique:!0});case 1:(n=indexedDB.open(I)).onerror=function(e){},n.onsuccess=function(e){!function(e){if(e.objectStoreNames.contains(D)){var t=e.transaction(D).objectStore(D),n=new S,r=t.openCursor();r.onerror=function(e){console.warn("Unable to cleanup old IDB.",e)},r.onsuccess=function(){var t=r.result;if(t){var i=t.value;n.deleteToken(i.fcmSenderId,i.fcmToken,i.fcmPushSet),t.continue()}else e.close(),indexedDB.deleteDatabase(I)}}}(n.result)};case 2:var o,s=(o=e.transaction.objectStore(this.objectStoreName)).openCursor();s.onsuccess=function(){var e=s.result;if(e){var t=e.value,n=i({},t);t.createTime||(n.createTime=Date.now()),"string"==typeof t.vapidKey&&(n.vapidKey=O(t.vapidKey)),"string"==typeof t.auth&&(n.auth=O(t.auth).buffer),"string"==typeof t.auth&&(n.p256dh=O(t.p256dh).buffer),e.update(n),e.continue()}}}},t.prototype.getTokenDetailsFromToken=function(e){return o(this,void 0,void 0,function(){return s(this,function(t){if(!e)throw E.create(v.BAD_TOKEN);return k({fcmToken:e}),[2,this.getIndex("fcmToken",e)]})})},t.prototype.getTokenDetailsFromSWScope=function(e){return o(this,void 0,void 0,function(){return s(this,function(t){if(!e)throw E.create(v.BAD_SCOPE);return k({swScope:e}),[2,this.get(e)]})})},t.prototype.saveTokenDetails=function(e){return o(this,void 0,void 0,function(){return s(this,function(t){if(!e.swScope)throw E.create(v.BAD_SCOPE);if(!e.vapidKey)throw E.create(v.BAD_VAPID_KEY);if(!e.endpoint||!e.auth||!e.p256dh)throw E.create(v.BAD_SUBSCRIPTION);if(!e.fcmSenderId)throw E.create(v.BAD_SENDER_ID);if(!e.fcmToken)throw E.create(v.BAD_TOKEN);if(!e.fcmPushSet)throw E.create(v.BAD_PUSH_SET);return k(e),[2,this.put(e)]})})},t.prototype.deleteToken=function(e){return o(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return"string"!=typeof e||0===e.length?[2,Promise.reject(E.create(v.INVALID_DELETE_TOKEN))]:[4,this.getTokenDetailsFromToken(e)];case 1:if(!(t=n.sent()))throw E.create(v.DELETE_TOKEN_NOT_FOUND);return[4,this.delete(t.swScope)];case 2:return n.sent(),[2,t]}})})},t}(A);function k(e){if(e.fcmToken&&("string"!=typeof e.fcmToken||0===e.fcmToken.length))throw E.create(v.BAD_TOKEN);if(e.swScope&&("string"!=typeof e.swScope||0===e.swScope.length))throw E.create(v.BAD_SCOPE);if(e.vapidKey&&(!(e.vapidKey instanceof Uint8Array)||65!==e.vapidKey.length))throw E.create(v.BAD_VAPID_KEY);if(e.endpoint&&("string"!=typeof e.endpoint||0===e.endpoint.length))throw E.create(v.BAD_SUBSCRIPTION);if(e.auth&&!(e.auth instanceof ArrayBuffer))throw E.create(v.BAD_SUBSCRIPTION);if(e.p256dh&&!(e.p256dh instanceof ArrayBuffer))throw E.create(v.BAD_SUBSCRIPTION);if(e.fcmSenderId&&("string"!=typeof e.fcmSenderId||0===e.fcmSenderId.length))throw E.create(v.BAD_SENDER_ID);if(e.fcmPushSet&&("string"!=typeof e.fcmPushSet||0===e.fcmPushSet.length))throw E.create(v.BAD_PUSH_SET);}var P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.dbName="fcm_vapid_details_db",t.dbVersion=1,t.objectStoreName="fcm_vapid_object_Store",t}return r(t,e),t.prototype.onDbUpgrade=function(e){e.result.createObjectStore(this.objectStoreName,{keyPath:"swScope"})},t.prototype.getVapidFromSWScope=function(e){return o(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:if("string"!=typeof e||0===e.length)throw E.create(v.BAD_SCOPE);return[4,this.get(e)];case 1:return[2,(t=n.sent())?t.vapidKey:void 0]}})})},t.prototype.saveVapidDetails=function(e,t){return o(this,void 0,void 0,function(){var n;return s(this,function(r){if("string"!=typeof e||0===e.length)throw E.create(v.BAD_SCOPE);if(null===t||65!==t.length)throw E.create(v.BAD_VAPID_KEY);return n={swScope:e,vapidKey:t},[2,this.put(n)]})})},t.prototype.deleteVapidDetails=function(e){return o(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return[4,this.getVapidFromSWScope(e)];case 1:if(!(t=n.sent()))throw E.create(v.DELETE_SCOPE_NOT_FOUND);return[4,this.delete(e)];case 2:return n.sent(),[2,t]}})})},t}(A),C="messagingSenderId",B=function(){function e(e){var t=this;if(!e.options[C]||"string"!=typeof e.options[C])throw E.create(v.BAD_SENDER_ID);this.messagingSenderId=e.options[C],this.tokenDetailsModel=new N,this.vapidDetailsModel=new P,this.iidModel=new S,this.app=e,this.INTERNAL={delete:function(){return t.delete()}}}return e.prototype.getToken=function(){return o(this,void 0,void 0,function(){var e,t,n,r,i;return s(this,function(o){switch(o.label){case 0:if("denied"===(e=this.getNotificationPermission_()))throw E.create(v.NOTIFICATIONS_BLOCKED);return"granted"!==e?[2,null]:[4,this.getSWRegistration_()];case 1:return t=o.sent(),[4,this.getPublicVapidKey_()];case 2:return n=o.sent(),[4,this.getPushSubscription(t,n)];case 3:return r=o.sent(),[4,this.tokenDetailsModel.getTokenDetailsFromSWScope(t.scope)];case 4:return(i=o.sent())?[2,this.manageExistingToken(t,r,n,i)]:[2,this.getNewToken(t,r,n)]}})})},e.prototype.manageExistingToken=function(e,t,n,r){return o(this,void 0,void 0,function(){return s(this,function(i){switch(i.label){case 0:return function(e,t,n){if(!n.vapidKey||!T(t.buffer,n.vapidKey.buffer))return!1;var r=e.endpoint===n.endpoint,i=T(e.getKey("auth"),n.auth),o=T(e.getKey("p256dh"),n.p256dh);return r&&i&&o}(t,n,r)?Date.now()<r.createTime+6048e5?[2,r.fcmToken]:[2,this.updateToken(e,t,n,r)]:[4,this.deleteTokenFromDB(r.fcmToken)];case 1:return i.sent(),[2,this.getNewToken(e,t,n)]}})})},e.prototype.updateToken=function(e,t,n,r){return o(this,void 0,void 0,function(){var i,o,a;return s(this,function(s){switch(s.label){case 0:return s.trys.push([0,4,,6]),[4,this.iidModel.updateToken(this.messagingSenderId,r.fcmToken,r.fcmPushSet,t,n)];case 1:return i=s.sent(),o={swScope:e.scope,vapidKey:n,fcmSenderId:this.messagingSenderId,fcmToken:i,fcmPushSet:r.fcmPushSet,createTime:Date.now(),endpoint:t.endpoint,auth:t.getKey("auth"),p256dh:t.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(o)];case 2:return s.sent(),[4,this.vapidDetailsModel.saveVapidDetails(e.scope,n)];case 3:return s.sent(),[2,i];case 4:return a=s.sent(),[4,this.deleteToken(r.fcmToken)];case 5:throw s.sent(),a;case 6:return[2]}})})},e.prototype.getNewToken=function(e,t,n){return o(this,void 0,void 0,function(){var r,i;return s(this,function(o){switch(o.label){case 0:return[4,this.iidModel.getToken(this.messagingSenderId,t,n)];case 1:return r=o.sent(),i={swScope:e.scope,vapidKey:n,fcmSenderId:this.messagingSenderId,fcmToken:r.token,fcmPushSet:r.pushSet,createTime:Date.now(),endpoint:t.endpoint,auth:t.getKey("auth"),p256dh:t.getKey("p256dh")},[4,this.tokenDetailsModel.saveTokenDetails(i)];case 2:return o.sent(),[4,this.vapidDetailsModel.saveVapidDetails(e.scope,n)];case 3:return o.sent(),[2,r.token]}})})},e.prototype.deleteToken=function(e){return o(this,void 0,void 0,function(){var t,n;return s(this,function(r){switch(r.label){case 0:return[4,this.deleteTokenFromDB(e)];case 1:return r.sent(),[4,this.getSWRegistration_()];case 2:return(t=r.sent())?[4,t.pushManager.getSubscription()]:[3,4];case 3:if(n=r.sent())return[2,n.unsubscribe()];r.label=4;case 4:return[2,!0]}})})},e.prototype.deleteTokenFromDB=function(e){return o(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:return[4,this.tokenDetailsModel.deleteToken(e)];case 1:return t=n.sent(),[4,this.iidModel.deleteToken(t.fcmSenderId,t.fcmToken,t.fcmPushSet)];case 2:return n.sent(),[2]}})})},e.prototype.getPushSubscription=function(e,t){return e.pushManager.getSubscription().then(function(n){return n||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:t})})},e.prototype.requestPermission=function(){throw E.create(v.AVAILABLE_IN_WINDOW);},e.prototype.useServiceWorker=function(e){throw E.create(v.AVAILABLE_IN_WINDOW);},e.prototype.usePublicVapidKey=function(e){throw E.create(v.AVAILABLE_IN_WINDOW);},e.prototype.onMessage=function(e,t,n){throw E.create(v.AVAILABLE_IN_WINDOW);},e.prototype.onTokenRefresh=function(e,t,n){throw E.create(v.AVAILABLE_IN_WINDOW);},e.prototype.setBackgroundMessageHandler=function(e){throw E.create(v.AVAILABLE_IN_SW);},e.prototype.delete=function(){return o(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,Promise.all([this.tokenDetailsModel.closeDatabase(),this.vapidDetailsModel.closeDatabase()])];case 1:return e.sent(),[2]}})})},e.prototype.getNotificationPermission_=function(){return Notification.permission},e.prototype.getTokenDetailsModel=function(){return this.tokenDetailsModel},e.prototype.getVapidDetailsModel=function(){return this.vapidDetailsModel},e.prototype.getIidModel=function(){return this.iidModel},e}(),R=function(e){function t(t){var n=e.call(this,t)||this;return n.bgMessageHandler=null,self.addEventListener("push",function(e){n.onPush(e)}),self.addEventListener("pushsubscriptionchange",function(e){n.onSubChange(e)}),self.addEventListener("notificationclick",function(e){n.onNotificationClick(e)}),n}return r(t,e),t.prototype.onPush=function(e){e.waitUntil(this.onPush_(e))},t.prototype.onSubChange=function(e){e.waitUntil(this.onSubChange_(e))},t.prototype.onNotificationClick=function(e){e.waitUntil(this.onNotificationClick_(e))},t.prototype.onPush_=function(e){return o(this,void 0,void 0,function(){var t,n,r,i,o,a;return s(this,function(s){switch(s.label){case 0:if(!e.data)return[2];try{t=e.data.json()}catch(e){return[2]}return[4,this.hasVisibleClients_()];case 1:return s.sent()?[2,this.sendMessageToWindowClients_(t)]:(n=this.getNotificationData_(t))?(r=n.title||"",[4,this.getSWRegistration_()]):[3,3];case 2:return i=s.sent(),o=n.actions,a=Notification.maxActions,o&&a&&o.length>a&&console.warn("This browser only supports "+a+" actions.The remaining actions will not be displayed."),[2,i.showNotification(r,n)];case 3:return this.bgMessageHandler?[4,this.bgMessageHandler(t)]:[3,5];case 4:return s.sent(),[2];case 5:return[2]}})})},t.prototype.onSubChange_=function(e){return o(this,void 0,void 0,function(){var e,t,n,r;return s(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.getSWRegistration_()];case 1:return e=i.sent(),[3,3];case 2:throw t=i.sent(),E.create(v.UNABLE_TO_RESUBSCRIBE,{message:t});case 3:return i.trys.push([3,5,,8]),[4,e.pushManager.getSubscription()];case 4:return i.sent(),[3,8];case 5:return n=i.sent(),[4,this.getTokenDetailsModel().getTokenDetailsFromSWScope(e.scope)];case 6:if(!(r=i.sent()))throw n;return[4,this.deleteToken(r.fcmToken)];case 7:throw i.sent(),n;case 8:return[2]}})})},t.prototype.onNotificationClick_=function(e){return o(this,void 0,void 0,function(){var t,n,r,i;return s(this,function(o){switch(o.label){case 0:return e.notification&&e.notification.data&&e.notification.data.FCM_MSG?e.action?[2]:(e.stopImmediatePropagation(),e.notification.close(),(t=e.notification.data.FCM_MSG).notification&&(n=t.notification.click_action)?[4,this.getWindowClient_(n)]:[2]):[2];case 1:return(r=o.sent())?[3,3]:[4,self.clients.openWindow(n)];case 2:return r=o.sent(),[3,5];case 3:return[4,r.focus()];case 4:r=o.sent(),o.label=5;case 5:return r?(delete t.notification,i=L(b.NOTIFICATION_CLICKED,t),[2,this.attemptToMessageClient_(r,i)]):[2]}})})},t.prototype.getNotificationData_=function(e){if(e&&"object"==typeof e.notification){var t,n=i({},e.notification);return n.data=i({},e.notification.data,((t={}).FCM_MSG=e,t)),n}},t.prototype.setBackgroundMessageHandler=function(e){if(!e||"function"!=typeof e)throw E.create(v.BG_HANDLER_FUNCTION_EXPECTED);this.bgMessageHandler=e},t.prototype.getWindowClient_=function(e){return o(this,void 0,void 0,function(){var t,n,r,i;return s(this,function(o){switch(o.label){case 0:return t=new URL(e,self.location.href).href,[4,U()];case 1:for(n=o.sent(),r=null,i=0;i<n.length;i++)if(new URL(n[i].url,self.location.href).href===t){r=n[i];break}return[2,r]}})})},t.prototype.attemptToMessageClient_=function(e,t){return o(this,void 0,void 0,function(){return s(this,function(n){if(!e)throw E.create(v.NO_WINDOW_CLIENT_TO_MSG);return e.postMessage(t),[2]})})},t.prototype.hasVisibleClients_=function(){return o(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,U()];case 1:return[2,e.sent().some(function(e){return"visible"===e.visibilityState})]}})})},t.prototype.sendMessageToWindowClients_=function(e){return o(this,void 0,void 0,function(){var t,n,r=this;return s(this,function(i){switch(i.label){case 0:return[4,U()];case 1:return t=i.sent(),n=L(b.PUSH_MSG_RECEIVED,e),[4,Promise.all(t.map(function(e){return r.attemptToMessageClient_(e,n)}))];case 2:return i.sent(),[2]}})})},t.prototype.getSWRegistration_=function(){return o(this,void 0,void 0,function(){return s(this,function(e){return[2,self.registration]})})},t.prototype.getPublicVapidKey_=function(){return o(this,void 0,void 0,function(){var e,t;return s(this,function(n){switch(n.label){case 0:return[4,this.getSWRegistration_()];case 1:if(!(e=n.sent()))throw E.create(v.SW_REGISTRATION_EXPECTED);return[4,this.getVapidDetailsModel().getVapidFromSWScope(e.scope)];case 2:return null==(t=n.sent())?[2,m]:[2,t]}})})},t}(B);function U(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function L(e,t){return(n={})[_.TYPE_OF_MSG]=e,n[_.DATA]=t,n;var n}var F=function(e){function t(t){var n=e.call(this,t)||this;return n.registrationToUse=null,n.publicVapidKeyToUse=null,n.manifestCheckPromise=null,n.messageObserver=null,n.tokenRefreshObserver=null,n.onMessageInternal=f(function(e){n.messageObserver=e}),n.onTokenRefreshInternal=f(function(e){n.tokenRefreshObserver=e}),n.setupSWMessageListener_(),n}return r(t,e),t.prototype.getToken=function(){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return this.manifestCheckPromise||(this.manifestCheckPromise=function(){return o(this,void 0,void 0,function(){var e,t;return s(this,function(n){switch(n.label){case 0:if(!(e=document.querySelector('link[rel="manifest"]')))return[2];n.label=1;case 1:return n.trys.push([1,4,,5]),[4,fetch(e.href)];case 2:return[4,n.sent().json()];case 3:return t=n.sent(),[3,5];case 4:return n.sent(),[2];case 5:if(!t||!t.gcm_sender_id)return[2];if("103953800507"!==t.gcm_sender_id)throw E.create(v.INCORRECT_GCM_SENDER_ID);return[2]}})})}()),[4,this.manifestCheckPromise];case 1:return t.sent(),[2,e.prototype.getToken.call(this)]}})})},t.prototype.requestPermission=function(){return o(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return"granted"===this.getNotificationPermission_()?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(e=t.sent()))return[2];throw"denied"===e?E.create(v.PERMISSION_BLOCKED):E.create(v.PERMISSION_DEFAULT);}})})},t.prototype.useServiceWorker=function(e){if(!(e instanceof ServiceWorkerRegistration))throw E.create(v.SW_REGISTRATION_EXPECTED);if(null!=this.registrationToUse)throw E.create(v.USE_SW_BEFORE_GET_TOKEN);this.registrationToUse=e},t.prototype.usePublicVapidKey=function(e){if("string"!=typeof e)throw E.create(v.INVALID_PUBLIC_VAPID_KEY);if(null!=this.publicVapidKeyToUse)throw E.create(v.USE_PUBLIC_KEY_BEFORE_GET_TOKEN);var t=O(e);if(65!==t.length)throw E.create(v.PUBLIC_KEY_DECRYPTION_FAILED);this.publicVapidKeyToUse=t},t.prototype.onMessage=function(e,t,n){return"function"==typeof e?this.onMessageInternal(e,t,n):this.onMessageInternal(e)},t.prototype.onTokenRefresh=function(e,t,n){return"function"==typeof e?this.onTokenRefreshInternal(e,t,n):this.onTokenRefreshInternal(e)},t.prototype.waitForRegistrationToActivate_=function(e){var t=e.installing||e.waiting||e.active;return new Promise(function(n,r){if(t)if("activated"!==t.state)if("redundant"!==t.state){var i=function(){if("activated"===t.state)n(e);else{if("redundant"!==t.state)return;r(E.create(v.SW_REG_REDUNDANT))}t.removeEventListener("statechange",i)};t.addEventListener("statechange",i)}else r(E.create(v.SW_REG_REDUNDANT));else n(e);else r(E.create(v.NO_SW_IN_REG))})},t.prototype.getSWRegistration_=function(){var e=this;return this.registrationToUse?this.waitForRegistrationToActivate_(this.registrationToUse):(this.registrationToUse=null,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"}).catch(function(e){throw E.create(v.FAILED_DEFAULT_REGISTRATION,{browserErrorMessage:e.message});}).then(function(t){return e.waitForRegistrationToActivate_(t).then(function(){return e.registrationToUse=t,t.update(),t})}))},t.prototype.getPublicVapidKey_=function(){return o(this,void 0,void 0,function(){return s(this,function(e){return this.publicVapidKeyToUse?[2,this.publicVapidKeyToUse]:[2,m]})})},t.prototype.setupSWMessageListener_=function(){var e=this;navigator.serviceWorker.addEventListener("message",function(t){if(t.data&&t.data[_.TYPE_OF_MSG]){var n=t.data;switch(n[_.TYPE_OF_MSG]){case b.PUSH_MSG_RECEIVED:case b.NOTIFICATION_CLICKED:var r=n[_.DATA];e.messageObserver&&e.messageObserver.next(r)}}},!1)},t}(B);function K(){return self&&"ServiceWorkerGlobalScope"in self?"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}!function(e){var t=function(e){if(!K())throw E.create(v.UNSUPPORTED_BROWSER);return self&&"ServiceWorkerGlobalScope"in self?new R(e):new F(e)};t.isSupported=K;var n={Messaging:F};e.INTERNAL.registerService("messaging",t,n)}(t)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-messaging - be sure to load firebase-app.js first.");}var M,j}(this.firebase=this.firebase||{},firebase)

/**
* automatic comment
*/;
function WebPushLogger(settings){this._settings=settings;this.hasValidSettingsToLog=function(){if(typeof this._settings=='undefined'){throw new Error("Undefined WebPushSettings Exception");}if(!this._settings.isTestRun){return false}return true};this.log=function(val,color){if(!this.hasValidSettingsToLog()){return false}console.log(val);this.updateStatus(color,val);return true};this.err=function(val,ex){if(!this.hasValidSettingsToLog()){return false}console.error(val,ex);this.updateStatus("colorRed",val);return true};this.updateStatus=function(color,val){if(document.getElementById("status")!=null){val="<span class='"+color+"'>"+"["+(new Date).toLocaleTimeString()+"]"+" "+val+"<span>";var status=document.getElementById("status");status.innerHTML=status.innerHTML+"<br />"+val}}}

/**
* automatic comment
*/;
function WebPush(settings,logger){this._settings=settings;this._logger=logger;this.registerServiceWorker=function(){this._logger.log("Registering ServiceWorker...");return navigator.serviceWorker.register('/sw.js')}}

/**
* automatic comment
*/;
function FcmWebPush(serviceWorkerRegistration,settings,logger){this._settings=settings;this._logger=logger;this._authKey=window.firebaseAuthorizationKey;this._registration=serviceWorkerRegistration;this._token=null;this._messaging=window.firebase.messaging();var self;this.init=function(){var isValidServiceWorker=this.useServiceWorker(this._registration);if(!isValidServiceWorker){this._logger.log("Something went wrong with the ServiceWorker");return}this._logger.log("Checking notification permission...");this.handlePermission()};this.handlePermission=function(){self=this;this._messaging.requestPermission().then(function(){return self.getToken()}).then(function(token){self._token=token;self._logger.log("Permission granted!");if(self._token!==null){self.subscribeTokenToTopic(self._token,function(){self._logger.log("Successfully subscribed to topic! Run NewsPushSender to receive notifications","colorGreen")});if(typeof(self._settings.welcomePush)!=="undefined"&&self._settings.welcomePush){self.handleWelcomePushMessage()}}}).catch(function(err){switch(err.code){case"messaging/permission-blocked":self._logger.log("Permission denied!","colorRed");localStorage.removeItem("welcome-push-message");return;case"messaging/permission-default":self._logger.log("Permission default!","colorRed");localStorage.removeItem("welcome-push-message");return;case"messaging/token-unsubscribe-failed":self.registerServiceWorker();return;default:self._logger.log("An unexpected error occured. More information in console","colorRed");console.error("An unexpected error occured: ",err)}})};this.useServiceWorker=function(registration){try{this._messaging.useServiceWorker(registration);return true}catch(e){return false}};this.getToken=function(){return this._messaging.getToken()};this.subscribeTokenToTopic=function(token,success){this._logger.log("Subscribing token to topic: "+this._settings.firebaseTopic);var xhr=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");xhr.open('POST','https://iid.googleapis.com/iid/v1/'+token+'/rel/topics/'+this._settings.firebaseTopic);xhr.onreadystatechange=function(){if(xhr.readyState>3&&xhr.status===200){success(xhr.responseText)}};xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');xhr.setRequestHeader('Content-Type','application/json');xhr.setRequestHeader('Authorization','key='+this._authKey);xhr.send("");return xhr};this.unsubscribe=function(success){this._logger.log("Unsubscribing token from topic: "+this._settings.firebaseTopic);var xhr=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");xhr.open('POST','https://iid.googleapis.com/iid/v1:batchRemove');xhr.onreadystatechange=function(){if(xhr.readyState>3&&xhr.status===200){success(xhr.responseText)}};xhr.setRequestHeader('X-Requested-With','XMLHttpRequest');xhr.setRequestHeader('Content-Type','application/json');xhr.setRequestHeader('Authorization','key='+this._authKey);xhr.send(JSON.stringify({to:"/topics/"+this._settings.firebaseTopic,registration_tokens:[this._token]}));return xhr};this.sendNotification=function(title,options){this._logger.log("Message received: "+title);var notification=new Notification(title,options);notification.onclick=function(){if(options.url){window.open(options.url,"_blank")}notification.close()};return notification};this.handleWelcomePushMessage=function(){var payload=this._settings.welcomePush;if(window.localStorage){var localStorageKey="welcome-push-message";var isWelcomMessageAlreadySent=localStorage.getItem(localStorageKey)==="true";if(!isWelcomMessageAlreadySent&&"Notification"in window){this._logger.log("Sending welcome push message...");var title=payload.Title;var options={body:payload.Body,icon:"/favicon.ico",url:payload.Url};this.sendNotification(title,options);localStorage.setItem(localStorageKey,"true")}}};this.handleNewsPushMessage=function(payload){if("Notification"in window){var url=payload.Url+(payload.Url.indexOf("?")!==-1?"&":"?")+"utm_campaign=browser_notification&utm_source=desktop";var title=payload.Headline;var options={body:payload.Teaser,icon:payload.ImageUrl?payload.ImageUrl:"/favicon.ico",url:url,tag:payload.Tag,renotify:false,requireInteraction:true};return this.sendNotification(title,options)}return null};this._messaging.onMessage(function(payload){if(!payload||!payload.data){return}var isCurrentRouteSet=typeof(window.currentRoute)!=="undefined"&&window.currentRoute!=="";if(isCurrentRouteSet&&!self.isNotificationAllowed(window.currentRoute,payload.data,window.location.pathname)){return}if(typeof(payload.expireTime)!=="undefined"&&payload.expireTime!=null){var datetimeElements=payload.expireTime.split(' ');var dateElements=datetimeElements[0].split('-');var timeElements=datetimeElements[1].split(':');var expireTime=new Date.UTC(dateElements[0],dateElements[1],dateElements[2],timeElements[0],timeElements[1],timeElements[2]);var now=Date.now();if(now>=expireTime){return}}var key="last_notification_identifier";setTimeout(function(){if(localStorage.getItem(key)!==payload.data.NotificationIdentifier){localStorage.setItem(key,payload.data.NotificationIdentifier);self.handleNewsPushMessage(payload.data)}},Math.random()*1000)});this.isNotificationAllowed=function(route,payload,path){if(!route||!payload){return true}if(path&&payload.Url){var currentId=this.getNewsIdFromUrl(path);var idFromPayload=this.getNewsIdFromUrl(payload.Url);if(currentId!=null&&idFromPayload!=null&&currentId===idFromPayload){return false}}if(payload.HideOnTheseRoutes){var splittedRoutes=payload.HideOnTheseRoutes.split(";");for(var i=0;i<splittedRoutes.length;i++){if(splittedRoutes[i]===route){return false}}}return true};this.getNewsIdFromUrl=function(url){if(!url){return null}var splitted=url.split("-");if(splitted&&splitted.length>1){return splitted.slice(-1)[0]}return null};function googleAnalticsPermissonAccept(){window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'webPushPermissonAccept'})}function googleAnalticsPermissonDenied(){window.dataLayer=window.dataLayer||[];window.dataLayer.push({event:'webPushPermissonDenied'})}}

/**
* automatic comment
*/;
function WnsWebPush(serviceWorkerRegistration,settings,logger){this._registration=serviceWorkerRegistration;this._settings=settings;this._logger=logger;this.init=function(){}}

/**
* automatic comment
*/;
var config={apiKey:"AIzaSyA0Pztlypm8w6eE1TYQDbMDmuM0UL2c21U",authDomain:"marketsinsidercom.firebaseapp.com",databaseURL:"https://marketsinsidercom.firebaseio.com",projectId:"marketsinsidercom",storageBucket:"marketsinsidercom.appspot.com",messagingSenderId:"608989885452",appId:"1:608989885452:web:04135441dabf9e1b4caa29"};firebase.initializeApp(config);var firebaseAuthorizationKey="AAAAjcqgNAw:APA91bEHDaltl1Mm65h0YVyxOUlAUCAEXnVzV8EXHL-etIGXMqHofOwLazzHBEdFYQ5HI0p822fH5F014uh6hBVWLVRpy_BtvTVaMVIM7G5g-JhJ8C8f1aRv9ie18xzpgewEuVXbSGfL"

/**
* automatic comment
*/;
var logger=new WebPushLogger(webPushSettings);var webPush=new WebPush(webPushSettings,logger);var fcmWebPush=null;var wnsWebPush=null;function finWebpushInit(requestPermission){try{if('serviceWorker'in navigator){webPush.registerServiceWorker().then(function(registration){logger.log("ServiceWorker successfully registered!","colorBlack");if(typeof requestPermission!='boolean'||requestPermission===true){fcmWebPush=new FcmWebPush(registration,webPush._settings,logger);fcmWebPush.init();wnsWebPush=new WnsWebPush(registration,webPush._settings,logger);wnsWebPush.init()}}).catch(function(e){logger.err("Registering ServiceWorker failed: "+e.message,e);return false})}else{logger.log("Service workers are not supported!","colorRed");return false}}catch(e){return false}return true}